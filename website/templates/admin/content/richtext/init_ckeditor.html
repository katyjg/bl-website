<script type="text/javascript" src="{{ CKEDITOR_JS_URL }}"></script>

<style type="text/css">
    span.cke_skin_kama { border: none !important; }
    div[id*='cke_id_'] { margin-left: 10px; }
</style>

<script type="text/javascript">
		{% block config %}
    CKEDITOR.config.width = '700';
    CKEDITOR.config.height= '300';
    CKEDITOR.config.uicolor = '#EDEFF1';
	CKEDITOR.config.filebrowserBrowseUrl = '/admin/filer/folder/?t=file_ptr&_popup=1';
    CKEDITOR.config.toolbar = [
			{% block toolbar %}['Format','Styles','TextColor'],
			['Bold','Italic','Underline','Strike','-','Indent','BulletedList','NumberedList','Blockquote'],['Undo','Redo'],
			['Anchor', 'Link','Unlink','Image','Browse','PasteFromWord'],['Symbol','-','Subscript','Superscript'],
			['Maximize','Preview','ShowBlocks','Source']{% endblock %}
    ];
		{% endblock %}

    (function($){
        contentblock_init_handlers.push(function(){
            $('.order-machine textarea.item-richtext, #frontend_editor textarea.item-richtext').each(function(){
                feincms_richtext_add_ckeditor(this);
            });

            contentblock_move_handlers.poorify.push(function(item) {
                item.find('textarea.item-richtext').each(feincms_richtext_remove_ckeditor);
            });
            contentblock_move_handlers.richify.push(function(item) {
                item.find('textarea.item-richtext').each(feincms_richtext_add_ckeditor);
            });
        });
    })(feincms.jQuery);

    function feincms_richtext_remove_ckeditor(field) {
        var id = field ? field.id : this.id;
        if (id in CKEDITOR.instances) {
            CKEDITOR.instances[id].destroy();
        }
    }

    function feincms_richtext_add_ckeditor(field) {
        var id = field ? field.id : this.id;
        if (!(id in CKEDITOR.instances)) {
            CKEDITOR.replace(id);
        }
    }
</script>
