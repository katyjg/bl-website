{% load i18n simplewiki_utils %}
{% load get_version %}
{% load static %}
{% load tasklist_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
	<title>{{ 'SITE_NAME_SHORT'|get_from_settings }} - Staff Manual</title>
	<link href="/static/img/wikilogo.ico" rel="SHORTCUT ICON">
	
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700|Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
	<link type="text/css" href="/static/css/wp-style.css" rel="stylesheet">
	<link rel="stylesheet" media="screen,print" href="{{"simplewiki/css/base.css"|prepend_media_url}}" />
	<link rel="stylesheet" media="print" href="{{"simplewiki/css/base_print.css"|prepend_media_url}}" />
	<link rel="stylesheet" href="{{"simplewiki/css/autosuggest_inquisitor.css"|prepend_media_url}}" />
	<link href="{% static 'tasklist/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
	<link href="{% static 'tasklist/fontawesome/css/font-awesome.min.css' %}" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'tasklist/css/style.css' %}" type="text/css" media="screen" />
	<script type="text/javascript" src="{{"simplewiki/js/bsn.AutoSuggest_c_2.0.js"|prepend_media_url}}"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="/static/js/jquery.scroll.pack.js"></script>

	<script type="text/javascript">
	    $(function() {
	        $("#toTop").scrollToTop();
	    });
	</script>

	<!-- script type="text/javascript" src="/static/js/sidebar.js"></script-->
	<script type="text/javascript">
		function set_related_article_id(s) {
			document.getElementById('wiki_related_input_id').value = s.id;
			document.getElementById('wiki_related_input_submit').disabled=false;
		}
		var x = window.onload;
		window.onload = function(){
				var options = {
				script: "{% url 'search_related' wiki_article.get_url %}/?self={{wiki_article.pk }}&",
				json: true,
				varname: "query",
				maxresults: 35,
				callback: set_related_article_id,
				noresults: "{% trans "Nothing found!" %}"
			};
			var as = new AutoSuggest('wiki_related_input', options);
			if (typeof x == 'function')
				x();
		}
	</script>
	<script type="text/javascript">
	    $(document).ready(function(){
	
		    //Hide (Collapse) the toggle containers on load
		    $(".toggle_container").hide(); 
	
		    //Switch the "Open" and "Close" state per click then slide up/down (depending on open/close state)
		    $("a.trigger").click(function(){
			    $(this).toggleClass("active").next().slideToggle("fast");
			    return false; //Prevent the browser jump to the link anchor
		    });
			//$('#attach-form').on('change',".fileinput:file[name='attachment']",function(e){
			$('#attach-form').on('change','.fileinput',function(){
				//var files = e.originalEvent.target.files;
			    console.log('hey');
			    if (files.length > 0) {
			   	    var label = $(this).val().replace(/\\/g, '/').replace(/.*\//, '');
			   		$("#attachment-selected").val(label);    		
			    }
			});	
		    
	    });
	</script>

	<script type="text/javascript">	
	//$('#attach-form').on('change',".fileinput:file[name='attachment']",function(e){
	$('#attach-form').on('change','.fileinput',function(){
		//var files = e.originalEvent.target.files;
	    console.log('hey');
	    if (files.length > 0) {
	   	    var label = $(this).val().replace(/\\/g, '/').replace(/.*\//, '');
	   		$("#attachment-selected").val(label);    		
	    }
	});
	</script> 

    <!--[if lt IE 8]>
    <link type="text/css" href="/static/css/ie.css" rel="stylesheet">
    <![endif]-->

	{% block wiki_head %}{% endblock %}
</head>
<body  class="{% block body_class %}{% endblock %}">
  <div class="content main-content">
	  <div class="fixed-banner wiki" id="header">
		<div class="banner-heading pull-left"><a title="Wiki Homepage" href="/wiki/"><i class="fa fa-lightbulb-o"></i> 
			<strong class="hidden-xs">{% site_name %} Wiki</strong></a>
		</div>
		<div class="pull-right">
            <form id="search-form" method="POST" action='{% url 'wiki_search_articles' 'mainpage' %}'>
              {% csrf_token %}
              <div class="input-group">  
                <input class="form-control" type="text" placeholder="Search" name="value" id="wiki_search_input" value="{{wiki_search_query|escape}}"/>
            	<span class="input-group-btn"><a class="btn btn-primary" title="{% trans 'Search' %}" href="javascript:{}" onclick="document.getElementById('search-form').submit();"><i class="fa fa-search fa-1"></i></a></span>
            	<!-- a class="btn btn-sm btn-white" onclick="javascript:location.href='{% url 'wiki_random' wiki_article.get_url|stripslash %}'" title="{% trans "Random article" %}"><i class="fa fa-random fa-1"></i></a-->
              </div>
            </form>		
        </div>
		
	  </div>
      <div class="pad-wrapper">
		<div class="row section-title">
		  <div class="col-xs-12" style="padding-top: 1em; padding-bottom: 1em;">
			<h5 class="no-margin"><strong>{% if wiki_article.locked %}<i class="fa fa-lock fa-fw" title="{% trans 'This article has been locked' %}"></i>{% endif %}
				{% block wiki_page_title %}{% endblock %}</strong></h5>
		  </div>
		</div>
		<div class="row" style="padding-top: 1em;">
		  <div class="col-sm-9 col-xs-8">
		    <div id="pagebody" class="pagelet col-xs-12">
		    {% block wiki_body %}{% endblock %}
                {% if wiki_article %} 
            		<p class="pull-right"><i>{% trans "Last modified" %}:</i>&nbsp;&nbsp;{{ wiki_article.modified_on|date }}, {{ wiki_article.modified_on|time }}</i></p>
            	{% endif %}
		    </div>
		  </div>
  		  <div class="col-sm-3 col-xs-4">
		    {% block wiki_panel %}
		    <div class="col-xs-12">
		    <div id="wiki_panel" class="row">
	            <!--<form method="POST" action='{% url 'wiki_search_articles' wiki_article.get_url|stripslash %}'>-->
	            <div class="btn-group pull-right">
	            <a class="btn" onclick="document.getElementById('wiki_create_form').style.display='block';" title="{% trans "Create new article" %}"><i class="fa fa-plus fa-1"></i></a>
	            {% if wiki_article %} 
	              <a class="btn" onclick="javascript:location.href='{% url 'wiki_view' wiki_article.get_url|stripslash %}/'" title="{% trans "View article" %}"><i class="fa fa-eye fa-1"></i></a>
	              <a class="btn" onclick="javascript:location.href='{% url 'wiki_edit' wiki_article.get_url|stripslash %}'" {% if not wiki_write %} disabled="true"{%endif%} title="{% trans "Edit article" %}"><i class="fa fa-pencil fa-1"></i></a>
	              <a class="btn" onclick="javascript:location.href='{% url 'wiki_history' wiki_article.get_url|stripslash 1 %}'" title="{% trans "History" %}"><i class="fa fa-history fa-1"></i></a>
	            {% endif %}	            
	            </div>
	              <br/>
				<hr/>
    			{% if wiki_article %}
		    	<div class="wiki_box_contents">  <!--Attachments-->  
		        	<h5><strong>{% trans "Attachments" %}</strong></h5>
		        	{% if wiki_article.attachments %}
		        		{% for a in wiki_article.attachments %}    
		                    <a href="#" class="trigger"><span>&nbsp; &nbsp; &nbsp;</span>{{a.filename}} - ({% if a.get_size %}{{a.get_size|filesizeformat}}{% else %}Not Found{% endif %})</a>
		                    <ul class="toggle_container"><li>Path: <a href="/media/{{a.file}}">/media/{{a.file}}</a></li></ul>
		                {% endfor %}
		            {% else %}        
		        	    <p><i>({% trans "none" %})</i></p>
		            {% endif %}
		        	
		            {% if wiki_attachments_write %}
		            <form id="attach-form" method="POST" action="{% url 'add_attachment' wiki_article.get_url %}" enctype="multipart/form-data" target="wiki_attach_frame">
		            	{% csrf_token %}
			            <div class="input-group">
				            <span class="input-group-btn">
				                <span class="btn btn-white btn-file">
				                    Browse&hellip; <input type="file" class="fileinput" name="attachment">
				                </span>
				            </span>
				            <input id="attachment-selected" name="attachment" type="text" class="form-control" required readonly>
				            <span class="input-group-btn">
				            	<a class="btn btn-primary" title="{% trans 'Attach' %}" href="javascript:{}" onclick="document.getElementById('attach-form').submit();"><i class="fa fa-upload fa-fw"></i></a>
				            </span>
				        </div>
				        <input type="hidden" name="overwrite" id="wiki_attach_overwrite" value="1" />
		            
	            		<div id="wiki_attach_progress_container">
	            			<div id="wiki_attach_progress"><br /></div>
	            		</div>
	            	</form>
	            	<iframe name="wiki_attach_frame" style="display:none"></iframe>
		            {% endif %}
		       	</div>  <!--Attachments-->  
		       	<hr/>
        	<div class="wiki_box_contents"><!--Related Articles-->  
            	<h5><strong>{% trans "Related Articles" %}</strong></h5>
                {% if wiki_article.related.all %}
        	        <p>
        		    {% for rel in wiki_article.related.all %}
        		        <span class="related">
        			    {% if wiki_write %}
        				    <a href="""javascript:if(confirm('{% trans "Are you sure, you want to delete this relation?" %}')) { location.href='{% url "wiki_remove_relation" wiki_article.get_url rel.id%}'; }""">
        					    <img src="{{ "simplewiki/img/delete.gif"|prepend_media_url }}" alt="{% trans "remove relation" %}" />
        				    </a>
        			    {% endif %}
        			    <a href="{% url 'wiki_view' rel.get_url %}">{{rel.title}}</a>
        		        </span>
        		    {% endfor %}
        	        </p>
                {% else %}
        	        <p><i>({% trans "none" %})</i></p>
                {% endif %}
                {% if wiki_write %}
    		        <form id="related-form" method="POST" action="{% url 'add_related' wiki_article.get_url %}">
    		          {% csrf_token %}
				      <div class="input-group">  
		                <input class="form-control" type="text" placeholder="Related article" name="value" id="wiki_related_input"/>
		            	<input type="hidden" name="id" value="" id="wiki_related_input_id" />
		            	<span class="input-group-btn"><a class="btn btn-primary" title="{% trans 'Add related article' %}" href="javascript:{}" onclick="document.getElementById('related-form').submit();"><i class="fa fa-plus fa-fw"></i></a></span>
		            	<!-- a class="btn btn-sm btn-white" onclick="javascript:location.href='{% url 'wiki_random' wiki_article.get_url|stripslash %}'" title="{% trans "Random article" %}"><i class="fa fa-random fa-1"></i></a-->
		              </div>
    		        </form>
    		        
                {% endif %}
        	</div><!--/Related Articles-->  
    			<hr/>
    	{% endif %}
		       	

    
        		<div id="wiki_create_form">
    	          {% with "this.wiki_article_name.value.replace(/([^a-zA-Z0-9\-])/g, '')+'/_create/'" as theaction %}
    		        <form id="create-form" method="GET" onsubmit="this.action='{% url 'wiki_view' "" %}{{ wiki_article.get_url|stripslash }}/' + {{ theaction }};">
    		      {% endwith %}
    			  <h5><strong>{% trans "Create article" %}</strong></h5>
			      <div class="input-group">  
	                <input class="form-control" type="text" placeholder="Title of new article" name="wiki_article_name" id="id_wiki_article_name"/>
	            	<input class="form-control" type="hidden" name="wiki_article_is_child" id="id_wiki_artcile_is_child" disabled="true" checked={%if wiki_article%}"yes"{%else%}"no"{%endif%}>
	            	<span class="input-group-btn"><a class="btn btn-primary" title="{% trans 'Create new article' %}" href="javascript:{}" onclick="document.getElementById('create-form').submit();"><i class="fa fa-plus fa-fw"></i></a></span>
	            	<!-- a class="btn btn-sm btn-white" onclick="javascript:location.href='{% url 'wiki_random' wiki_article.get_url|stripslash %}'" title="{% trans "Random article" %}"><i class="fa fa-random fa-1"></i></a-->
	              </div>
    		        </form>
    	    </div>


			<hr/>

</div></div>
		    {% endblock %}
		  </div>
		</div>
  	</div>
  </div>

<a id="toTop" class="wiki" title="Scroll To Top">&nbsp;</a>  
 
</body>
</html>

{% comment %}

{% load i18n simplewiki_utils %}
{% load get_version %}
<!--<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="{{ LANGUAGE_CODE }}">-->
<head>
<!--title>{{ wiki_title }}</title-->
<title>{{ 'SITE_NAME_SHORT'|get_from_settings }} - Staff Manual</title>
<link href="/static/img/wikilogo.ico" rel="SHORTCUT ICON">

<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700|Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
<link type="text/css" href="/static/css/wp-style.css" rel="stylesheet">
<link rel="stylesheet" media="screen,print" href="{{"simplewiki/css/base.css"|prepend_media_url}}" />
<link rel="stylesheet" media="print" href="{{"simplewiki/css/base_print.css"|prepend_media_url}}" />
<link rel="stylesheet" href="{{"simplewiki/css/autosuggest_inquisitor.css"|prepend_media_url}}" />
{% load static %}
<link href="{% static 'tasklist/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'tasklist/fontawesome/css/font-awesome.min.css' %}" rel="stylesheet">

<script type="text/javascript" src="{{"simplewiki/js/bsn.AutoSuggest_c_2.0.js"|prepend_media_url}}"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>

<script type="text/javascript" src="/static/js/jquery.scroll.pack.js"></script>

<script type="text/javascript">
    $(function() {
        $("#toTop").scrollToTop();
    });
</script>

<script type="text/javascript" src="/static/js/sidebar.js"></script>
<script type="text/javascript">
	function set_related_article_id(s) {
		document.getElementById('wiki_related_input_id').value = s.id;
		document.getElementById('wiki_related_input_submit').disabled=false;
	}
	var x = window.onload;
	window.onload = function(){
			var options = {
			script: "{% url 'search_related' wiki_article.get_url %}/?self={{wiki_article.pk }}&",
			json: true,
			varname: "query",
			maxresults: 35,
			callback: set_related_article_id,
			noresults: "{% trans "Nothing found!" %}"
		};
		var as = new AutoSuggest('wiki_related_input', options);
		if (typeof x == 'function')
			x();
	}
</script>
<script type="text/javascript">
    $(document).ready(function(){

	    //Hide (Collapse) the toggle containers on load
	    $(".toggle_container").hide(); 

	    //Switch the "Open" and "Close" state per click then slide up/down (depending on open/close state)
	    $("a.trigger").click(function(){
		    $(this).toggleClass("active").next().slideToggle("fast");
		    return false; //Prevent the browser jump to the link anchor
	    });

    });
</script>


    <!--[if lt IE 8]>
    <link type="text/css" href="/static/css/ie.css" rel="stylesheet">
    <![endif]-->

{% block wiki_head %}
{% endblock %}
</head>

<body>
<div id="header" class="wiki">
    <div class="banner">
     	<a class="facility-logo" href="http://www.lightsource.ca" title="Canadian Light Source, Inc"></a>
        <a title="Back to Wiki Homepage" href="/wiki/"><div class="logo"></div></a>
    </div>
</div>

<div id="headline"><div class="wrapper"><h2>{% block wiki_page_title %}{% endblock %}</h2></div></div>
<div id="pagebody">
<div class="wrapper">
    <div id="bodyContent" class="col-8">
        {% block wiki_body %}{% endblock %}
    </div><!--col-8-->
    
    <div class="col-4">
{% block wiki_panel %}

<div id="wiki_panel">

    <div class="wiki_box">  <!--Search-->
    	<div class="wiki_box_contents">
            <!--<form method="POST" action='{% url 'wiki_search_articles' wiki_article.get_url|stripslash %}'>-->
            <form method="POST" action='{% url 'wiki_search_articles' 'mainpage' %}'>
            	<nobr>
                <input type="text" name="value" id="wiki_search_input" style="width: 72%" value="{{wiki_search_query|escape}}"/>
            	<input type="submit" id="wiki_search_input_submit" value={% trans "Search!" %} style="width: 20%" />
                </nobr>
            </form>
        </div>
    </div>  <!--/Search-->
    
    <div class="wiki_box">  <!--Edit-->
    	<div class="wiki_box_contents" style="position: relative;">
        	<div id="wiki_create_form">
    	        {% with "this.wiki_article_name.value.replace(/([^a-zA-Z0-9\-])/g, '')+'/_create/'" as theaction %}
    		        <form method="GET" onsubmit="this.action='{% url 'wiki_view' "" %}{{ wiki_article.get_url|stripslash }}/' + {{ theaction }};">
    		    {% endwith %}
    			<h2>{% trans "Create article" %}</h2>
    			<p>
    			    <label for="id_wiki_article_name">{% trans "Title of article" %}</label>
    			    <input type="text" name="wiki_article_name" id="id_wiki_article_name" /><br/>
    			    <label for="id_wiki_article_is_child">{% trans "Create as a child of current article"%}</label>
    			    <input type="checkbox" name="wiki_article_is_child" id="id_wiki_artcile_is_child" disabled="true" checked={%if wiki_article%}"yes"{%else%}"no"{%endif%}>
    			</p>
    			<p>
    				<input type="button" class="button" value="{% trans "Cancel" %}" style="display: inline-block; margin-right: 2px;" onclick="document.getElementById('wiki_create_form').style.display='none';" />
    				<input type="submit" class="button" value="{% trans "Next" %} &gt;" style="display: inline-block; margin-right: 2px; font-weight: bold;" />
    			</p>
    		        </form>
    	    </div>
            {% if wiki_article %} 
           	    <input type="button" onclick="javascript:location.href='{% url 'wiki_view' wiki_article.get_url|stripslash %}/'" value="View" /><br />
                <input type="button" onclick="javascript:location.href='{% url 'wiki_edit' wiki_article.get_url|stripslash %}'" value="Edit" {% if not wiki_write %} disabled="true"{%endif%} /><br />
                <input type="button" onclick="javascript:location.href='{% url 'wiki_history' wiki_article.get_url|stripslash 1 %}'" value="History" />
            {% endif %}
            <input type="button" onclick="document.getElementById('wiki_create_form').style.display='block';" value="{% trans "Create article" %}" class="button" /><br />
            <input type="button" onclick="javascript:location.href='{% url 'wiki_random' wiki_article.get_url|stripslash %}'" value="{% trans "Random article" %}" class="button" />
            {% if wiki_article %} 
           	    {% if wiki_article.locked %}
            	    <p><strong>{% trans "This article has been locked" %}</strong></p>
            	{% endif %}
            	<p><i>{% trans "Last modified" %}:</i>&nbsp;&nbsp;{{ wiki_article.modified_on|date }}, {{ wiki_article.modified_on|time }}</i></p>
            {% endif %}
     	</div>
    </div>  <!--/Edit-->

    <div class="wiki_box">  <!--Attachments-->  
    	<div class="wiki_box_contents">
        	<div class="wiki_box_title">{% trans "Attachments" %}</div>
        	{% if wiki_article.attachments %}
        		{% for a in wiki_article.attachments %}    
                    <a href="#" class="trigger"><span>&nbsp; &nbsp; &nbsp;</span>{{a.filename}} - ({% if a.get_size %}{{a.get_size|filesizeformat}}{% else %}Not Found{% endif %})</a>
                    <ul class="toggle_container"><li>Path: <a href="/static/{{a.file}}">/static/{{a.file}}</a></li></ul>
                {% endfor %}
            {% else %}        
        	    <p><i>({% trans "none" %})</i></p>
            {% endif %}


        	
            {% if wiki_attachments_write %}
            	<form method="POST" action="{% url 'add_attachment' wiki_article.get_url %}" enctype="multipart/form-data" target="wiki_attach_frame">
            		<input type="file" class="fileinput" name="attachment" size="10" /><br />
            		<p><input type="checkbox" name="overwrite" id="wiki_attach_overwrite" value="1" /> Overwrite filename</p>
            		<p><input type="submit" value="Attach" /></p>
            		<div id="wiki_attach_progress_container">
            			<div id="wiki_attach_progress"><br /></div>
            		</div>
            	</form>
            	<iframe name="wiki_attach_frame" style="display:none"></iframe>
            {% endif %}
       	</div>
    </div>  <!--/Attachments-->  


    {% if wiki_article %}
        <div class="wiki_box">  <!--Related Articles-->  
        	<div class="wiki_box_contents">
            	<div class="wiki_box_title">{% trans "Related articles" %}</div>
                {% if wiki_article.related.all %}
        	        <p>
        		    {% for rel in wiki_article.related.all %}
        		        <span class="related">
        			    {% if wiki_write %}
        				    <a href="""javascript:if(confirm('{% trans "Are you sure, you want to delete this relation?" %}')) { location.href='{% url "wiki_remove_relation" wiki_article.get_url rel.id%}'; }""">
        					    <img src="{{ "simplewiki/img/delete.gif"|prepend_media_url }}" alt="{% trans "remove relation" %}" />
        				    </a>
        			    {% endif %}
        			    <a href="{% url 'wiki_view' rel.get_url %}">{{rel.title}}</a>
        		        </span>
        		    {% endfor %}
        	        </p>
                {% else %}
        	        <p><i>({% trans "none" %})</i></p>
                {% endif %}
                {% if wiki_write %}
                    <form method="POST" action="{% url 'add_related' wiki_article.get_url %}">
                    	<nobr><input type="text" name="value" id="wiki_related_input" style="width: 72%" />
                    	<input type="submit" id="wiki_related_input_submit" disabled="true" value="Add" style="width: 20%" /></nobr>
                    	<input type="hidden" name="id" value="" id="wiki_related_input_id" />
                    </form>
                {% endif %}
        	</div>
        </div>  <!--/Related Articles-->  
    {% endif %}

</div>

{% endblock %}
</div><!--col-3-->
<div class="spacer"></div>
</div><!--wrapper-->
</div><!--pagebody-->

<a id="toTop" class="wiki" title="Scroll To Top">&nbsp;</a>

</body>
<!--</html>-->
{% endcomment %}